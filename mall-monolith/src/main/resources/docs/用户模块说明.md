# 用户模块功能说明

## 概述

用户模块提供了完整的用户管理功能，包括用户注册、登录、信息管理、密码修改等功能。

## 主要功能

### 1. 用户注册

- **接口**: `POST /api/user/register`
- **功能**: 用户注册，支持用户名、密码、昵称、手机号、邮箱
- **验证**:
  - 用户名唯一性检查
  - 手机号格式验证
  - 邮箱格式验证
  - 手机号和邮箱唯一性检查

### 2. 用户登录

- **接口**: `POST /api/user/login`
- **功能**: 用户登录验证，返回 JWT token
- **验证**:
  - 用户名和密码验证
  - 用户状态检查
  - 密码加密存储

### 3. 用户信息管理

- **获取用户信息**: `GET /api/user/{id}`
- **获取当前用户信息**: `GET /api/user/current`
- **更新用户信息**: `PUT /api/user/update`
- **修改密码**: `PUT /api/user/updatePassword`

### 4. 数据验证接口

- **检查用户名**: `GET /api/user/checkUsername`
- **检查手机号**: `GET /api/user/checkPhone`
- **检查邮箱**: `GET /api/user/checkEmail`

### 5. 用户列表查询

- **接口**: `GET /api/user/list`
- **功能**: 分页查询用户列表，支持多条件筛选
- **查询条件**:
  - 用户名模糊查询
  - 昵称模糊查询
  - 手机号模糊查询
  - 邮箱模糊查询
  - 用户状态精确查询
- **分页参数**:
  - pageNum: 页码（从 1 开始）
  - pageSize: 每页大小
- **排序**: 按创建时间倒序排列

## 技术特性

### 1. 安全特性

- **密码加密**: 使用 BCrypt 进行密码加密存储
- **JWT 认证**: 使用 JWT token 进行身份认证
- **输入验证**: 使用 Jakarta Validation 进行参数验证
- **异常处理**: 统一的异常处理机制

### 2. 数据层

- **MyBatis Plus**: 使用 MyBatis Plus 进行数据库操作
- **数据库**: MySQL 数据库存储用户信息
- **索引优化**: 为用户名、手机号、邮箱建立唯一索引

### 3. 架构设计

- **分层架构**: Controller -> Service -> Mapper
- **DTO 模式**: 使用 DTO 进行数据传输
- **异常处理**: 自定义异常和全局异常处理器

## 数据库设计

### 用户表 (user)

```sql
CREATE TABLE `user` (
    `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '用户ID',
    `username` varchar(50) NOT NULL COMMENT '用户名',
    `password` varchar(255) NOT NULL COMMENT '密码',
    `nickname` varchar(50) DEFAULT NULL COMMENT '昵称',
    `phone` varchar(20) DEFAULT NULL COMMENT '手机号',
    `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
    `status` int(1) DEFAULT 1 COMMENT '状态：1-正常，0-禁用',
    `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_username` (`username`),
    UNIQUE KEY `uk_phone` (`phone`),
    UNIQUE KEY `uk_email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

## API 使用示例

### 1. 用户注册

```bash
curl -X POST http://localhost:8080/api/user/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456",
    "nickname": "测试用户",
    "phone": "13800138000",
    "email": "test@example.com"
  }'
```

### 2. 用户登录

```bash
curl -X POST http://localhost:8080/api/user/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456"
  }'
```

### 3. 获取当前用户信息

```bash
curl -X GET http://localhost:8080/api/user/current \
  -H "Authorization: Bearer <JWT_TOKEN>"
```

### 4. 更新用户信息

```bash
curl -X PUT http://localhost:8080/api/user/update \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <JWT_TOKEN>" \
  -d '{
    "nickname": "新昵称",
    "phone": "13800138001",
    "email": "newemail@example.com"
  }'
```

### 5. 获取用户列表

```bash
# 基本分页查询
curl -X GET "http://localhost:8080/api/user/list?pageNum=1&pageSize=10"

# 按用户名模糊查询
curl -X GET "http://localhost:8080/api/user/list?username=test&pageNum=1&pageSize=10"

# 按状态查询
curl -X GET "http://localhost:8080/api/user/list?status=1&pageNum=1&pageSize=10"

# 组合查询
curl -X GET "http://localhost:8080/api/user/list?username=test&status=1&pageNum=1&pageSize=5"
```

## 配置说明

### JWT 配置

```yaml
jwt:
  secret: mall-secret-key-12345678901234567890123456789012
  expiration: 86400 # 24小时，单位：秒
```

### 安全配置

- 登录和注册接口无需认证
- 其他用户接口需要 JWT token 认证
- 使用无状态会话管理

## 测试数据

系统预置了以下测试用户：

- 用户名: admin, 密码: 123456
- 用户名: testuser, 密码: 123456
